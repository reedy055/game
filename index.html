<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <!-- Disable zoom for app-like feel; we also keep font-size >=16px in inputs later -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no, maximum-scale=1" />
  <meta name="theme-color" content="#0F172A" />
  <meta name="format-detection" content="telephone=no" />
  <title>LifeRPG</title>

  <!-- Manifest (PWA) -->
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" type="image/png" href="assets/favicon.png">
  <link rel="apple-touch-icon" href="assets/icon-192.png">

  <!-- Styles -->
  <link rel="preload" href="styles.css" as="style">
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Minimal inline fallback so it isn't raw before CSS loads */
    body{background:#0B0F1A;color:#E6E9F2;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;margin:0}
  </style>
</head>
<body>
  <div id="app">

    <!-- Header / Hero -->
    <header class="app-header">
      <div class="hero">
        <div class="points">
          <div class="points-label">Points Today</div>
          <div id="statPoints" class="points-value">0</div>
        </div>
        <div class="pills">
          <button class="pill" id="pillStreak" data-nav="statsView" title="View stats">
            <span class="emoji">üî•</span><span id="statStreak">0</span>
          </button>
          <!-- Coins pill opens the Shop drawer -->
          <button class="pill" id="pillCoins" title="Open Shop">
            <span class="emoji">ü™ô</span><span id="statCoins">0</span>
          </button>
        </div>
        <div class="xpbar"><div id="xpFill" style="width:0%"></div></div>
      </div>
    </header>

    <!-- Main Views -->
    <main class="app-main">

      <!-- HOME -->
      <section id="homeView" class="view active" role="region" aria-label="Home">
        <!-- Daily Challenges (fixed 3/day; reroll removed) -->
        <div class="card">
          <div class="card-head">
            <h3>Daily Challenges</h3>
            <!-- keep legacy btnReroll to avoid breaking current app.js; hidden -->
            <button id="btnReroll" class="btn ghost small" style="display:none" disabled>‚Üª Reroll</button>
          </div>
          <div id="dailyList" class="list three-cards">
            <div class="placeholder">Your 3 challenges will appear here.</div>
          </div>
        </div>

        <!-- Weekly Boss Quest (new) -->
        <div class="card" id="bossCard">
          <div class="card-head">
            <h3>Weekly Boss</h3>
            <button id="btnBossDetails" class="btn ghost small">Details</button>
          </div>
          <div class="row" style="gap:16px; align-items:center; flex-wrap:wrap">
            <!-- Boss ring placeholder (canvas or SVG will render later) -->
            <div id="bossRing" aria-label="Weekly Boss Progress" style="width:120px;height:120px;border-radius:50%;background:rgba(91,140,255,.06);display:flex;align-items:center;justify-content:center;font-weight:800">0%</div>
            <div style="flex:1;min-width:220px">
              <div id="bossGoals" class="list">
                <div class="placeholder">Set up boss goals in Manage ‚Üí Boss (coming next patch).</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Completed Today (new) -->
        <div class="card">
          <div class="card-head">
            <h3>Completed Today</h3>
          </div>
          <div id="completedList" class="list">
            <div class="placeholder">Nothing yet. Tap the <strong>+</strong> to log a task.</div>
          </div>
        </div>

        <!-- Legacy sections kept hidden to avoid breaking existing JS until next patches -->
        <div class="card" style="display:none">
          <div class="card-head"><h3>Tasks (legacy)</h3></div>
          <div id="taskList" class="list">
            <div class="placeholder">Hidden (replaced by Quick Add + Completed Today).</div>
          </div>
        </div>

        <div class="card" style="display:none">
          <div class="card-head"><h3>Shop (legacy)</h3></div>
          <div id="shopList" class="list horizontal">
            <div class="placeholder">Hidden (open via Coins pill).</div>
          </div>
        </div>
      </section>

      <!-- STATS -->
      <section id="statsView" class="view" role="region" aria-label="Stats">
        <div class="grid two">
          <div class="card">
            <div class="card-head">
              <h3>Streak</h3>
            </div>
            <div class="streak-wrap">
              <div class="streak-badge"><span>üî•</span><span id="streakBig">0</span></div>
              <div class="streak-meta">
                <div>Best: <strong id="bestStreak">0</strong></div>
                <div>Completions/week: <strong id="cmpWeek">0</strong></div>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-head"><h3>30-Day Points</h3></div>
            <canvas id="bar30" width="600" height="260" aria-label="30 day points bar chart"></canvas>
          </div>
        </div>
        <div class="card">
          <div class="card-head"><h3>Calendar (90 days)</h3></div>
          <div id="heatmap" class="heatmap" aria-label="calendar heatmap"></div>
        </div>
      </section>

      <!-- MANAGE -->
      <section id="manageView" class="view" role="region" aria-label="Manage">
        <!-- Tasks -->
        <div class="card">
          <div class="card-head">
            <h3>Tasks</h3>
            <button id="btnAddTask" class="btn small">+ Add</button>
          </div>
          <div id="manageTasks" class="list admin">
            <div class="placeholder">No tasks yet. Click ‚Äú+ Add‚Äù.</div>
          </div>
        </div>
        <!-- Challenges -->
        <div class="card">
          <div class="card-head">
            <h3>Challenge Pool</h3>
            <button id="btnAddChallenge" class="btn small">+ Add</button>
          </div>
          <div id="manageChallenges" class="list admin">
            <div class="placeholder">No challenges yet. Click ‚Äú+ Add‚Äù.</div>
          </div>
        </div>
        <!-- Shop -->
        <div class="card">
          <div class="card-head">
            <h3>Shop Items</h3>
            <button id="btnAddShop" class="btn small">+ Add</button>
          </div>
          <div id="manageShop" class="list admin">
            <div class="placeholder">No rewards yet. Click ‚Äú+ Add‚Äù.</div>
          </div>
        </div>
        <!-- (Boss manage UI will be added in next JS patch; no static HTML needed here) -->
      </section>

      <!-- SETTINGS -->
      <section id="settingsView" class="view" role="region" aria-label="Settings">
        <div class="card">
          <div class="card-head"><h3>Game Settings</h3></div>
          <div class="form">
            <label>Reset hour (0‚Äì23)
              <input id="inpResetHour" type="number" min="0" max="23" value="4">
            </label>
            <label>Reroll cost (coins)
              <input id="inpRerollCost" type="number" min="0" max="999" value="20">
            </label>
            <label class="row">
              <input id="chkHaptics" type="checkbox" checked>
              <span>Haptics</span>
            </label>
          </div>
        </div>

        <div class="card">
          <div class="card-head"><h3>Data</h3></div>
          <div class="row wrap">
            <button id="btnExport" class="btn ghost">Export JSON</button>
            <label class="file">
              <input id="fileImport" type="file" accept="application/json">
              <span class="btn">Import JSON</span>
            </label>
            <button id="btnWipe" class="btn danger">Wipe All Data</button>
          </div>
        </div>

        <div class="card">
          <div class="card-head"><h3>About</h3></div>
          <p class="muted">LifeRPG ‚Äî offline, private, installable. Built with vanilla JS & IndexedDB. Host: GitHub Pages.</p>
        </div>
      </section>

    </main>

    <!-- Bottom Tab Bar (now fixed) -->
    <nav class="tabbar" role="tablist" aria-label="Primary">
      <button class="tab active" data-target="homeView" aria-selected="true">Home</button>
      <button class="tab" data-target="statsView">Stats</button>

      <!-- Center FAB slot (visual; actual FAB is separate element to overlap) -->
      <div class="tab spacer" aria-hidden="true"></div>

      <button class="tab" data-target="manageView">Manage</button>
      <button class="tab" data-target="settingsView">Settings</button>
    </nav>

    <!-- Floating Center FAB (+) -->
    <button id="fabAdd" class="fab" aria-label="Quick Add">Ôºã</button>

    <!-- Toast -->
    <div id="toast" class="toast" role="status" aria-live="polite"></div>

    <!-- Generic Modal (still used by Manage forms) -->
    <div id="modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-card">
        <div class="modal-head">
          <h3 id="modalTitle">Modal</h3>
          <button id="modalClose" class="icon-btn" aria-label="Close">‚úï</button>
        </div>
        <div id="modalBody" class="modal-body"></div>
        <div class="modal-actions">
          <button id="modalCancel" class="btn ghost">Cancel</button>
          <button id="modalOk" class="btn">Save</button>
        </div>
      </div>
    </div>

    <!-- Bottom Sheet: Quick Add -->
    <div id="drawerQuickAdd" class="drawer hidden" role="dialog" aria-modal="true" aria-labelledby="qaTitle">
      <div class="drawer-card">
        <div class="drawer-head">
          <div class="grab"></div>
          <h3 id="qaTitle">Quick Add</h3>
          <button id="qaClose" class="icon-btn" aria-label="Close">‚úï</button>
        </div>
        <!-- Favorites row (auto top 3) -->
        <div id="quickFavs" class="list horizontal" style="margin:8px 0"></div>
        <!-- All tasks (active) -->
        <div id="quickTasks" class="list horizontal" style="margin-bottom:8px">
          <div class="placeholder">No tasks yet ‚Äî add some in Manage ‚Üí Tasks.</div>
        </div>
      </div>
    </div>

    <!-- Bottom Sheet: Shop -->
    <div id="drawerShop" class="drawer hidden" role="dialog" aria-modal="true" aria-labelledby="shopTitle">
      <div class="drawer-card">
        <div class="drawer-head">
          <div class="grab"></div>
          <h3 id="shopTitle">Shop</h3>
          <button id="shopClose" class="icon-btn" aria-label="Close">‚úï</button>
        </div>
        <div id="shopDrawerList" class="list horizontal">
          <div class="placeholder">No rewards yet ‚Äî add some in Manage ‚Üí Shop.</div>
        </div>
      </div>
    </div>

  </div>

  <!-- Scripts -->
  <script type="module">
    import "./app.js";
  </script>
  <script>
    // Register SW early (kept)
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js').catch(()=>{});
    }
    // Tab switching fallback if app.js hasn't run yet
    (function(){
      const tabs = document.querySelectorAll('.tabbar .tab');
      const views = document.querySelectorAll('.view');
      tabs.forEach(btn=>{
        btn.addEventListener('click', ()=>{
          if (btn.classList.contains('spacer')) return;
          tabs.forEach(b=>b.classList.remove('active'));
          btn.classList.add('active');
          const id = btn.getAttribute('data-target');
          views.forEach(v=>v.classList.toggle('active', v.id===id));
        });
      });
    })();
  </script>
</body>
</html>
